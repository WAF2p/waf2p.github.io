(function () {
  async function loadContributors() {
    const repo = (window.__WAFPP_CONTRIB__ || {}).repo || "waf2p/waf2p.github.io";
    const status = document.getElementById("github-contrib-status");
    const wrap = document.getElementById("github-contributors");
    if (!status || !wrap) return;

    try {
      // Prefer build-time cache (generated by Jekyll plugin) to avoid rate limits.
      // Falls back to live GitHub API if the cache is missing.
      let data = null;
      try {
        const cached = await fetch(`/assets/data/github-contributors.json`, { cache: "no-cache" });
        if (cached.ok) {
          const cachedJson = await cached.json();
          data = cachedJson.contributors || cachedJson;
        }
      } catch (_) {}

      if (!data) {
        const res = await fetch(`https://api.github.com/repos/${repo}/contributors?per_page=12`);
        if (!res.ok) throw new Error("GitHub API error");
        data = await res.json();
      }

      wrap.innerHTML = "";
      data.slice(0, 12).forEach(c => {
        const a = document.createElement("a");
        a.href = c.html_url;
        a.target = "_blank";
        a.style.cssText = "display:inline-flex;width:34px;height:34px;border-radius:999px;overflow:hidden;border:1px solid rgba(0,0,0,.08);background:#fff;";
        const img = document.createElement("img");
        img.src = c.avatar_url;
        img.alt = c.login;
        img.style.cssText = "width:100%;height:100%;object-fit:cover;";
        a.appendChild(img);
        wrap.appendChild(a);
      });

      status.textContent = "";
    } catch (e) {
      status.textContent = "â€”";
      console.debug(e);
    }
  }
  window.addEventListener("DOMContentLoaded", loadContributors);
})();